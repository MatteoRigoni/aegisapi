# ADR-003: Authentication — OIDC/JWT plus API Keys

## Context
External clients include human users and partner systems. We need standards-based SSO plus non-OIDC access for service integrations.

## Decision
Primary: **OIDC (Azure AD)** issuing **JWT** access tokens (audience = AegisAPI). Secondary: **scoped API Keys** (per-client, per-route), stored in **Key Vault**, hashed at rest, rotated automatically. Both mapped to unified principal for downstream authZ.

## Alternatives
- Only OIDC: excludes simple partner integrations.
- mTLS only: strong identity but operationally heavy for broad partner base.
- HMAC signatures: stronger request integrity, but more client friction.

## Consequences
- Two auth modes increase complexity; mitigated by consistent principal/claims model.

## Security Impact
- Enforce **issuer/audience/exp/nbf** checks; rotate signing keys; short TTL access tokens.
- Keys: length ≥ 32 bytes, prefix-encoded, last-8 shown for debug; per-client rate limits.

## Assumptions
- Azure AD tenant control; partner onboarding process.

## Trade-offs
- API keys are weaker than JWT; limited to non-sensitive scopes & stricter rate limits.

## Acceptance Criteria
- Invalid/expired tokens → **401**; insufficient scopes/claims → **403**.
- API keys can be **created/rotated/revoked** via admin endpoint; audit logged.
